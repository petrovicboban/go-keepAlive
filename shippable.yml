language: go

go:
  - 1.8
  - 1.9

env:
  global:
    - CI_REPORT=shippable/testresults/junit.xml

before_install:
  - export GOPATH=$SHIPPABLE_GOPATH
  - go get github.com/t-yuki/gocover-cobertura    
  - go get github.com/jstemmer/go-junit-report
  - go get github.com/axw/gocov/gocov
  - go get github.com/axw/gocov/...
  - go get github.com/AlekSi/gocov-xml



script:
  - go test -coverprofile=coverage.txt -covermode count ./  2>&1 | $GOPATH/bin/go-junit-report > shippable/testresults/report.xml
  - $GOPATH/bin/gocov convert coverage.txt | $GOPATH/bin/gocov-xml > shippable/codecoverage/report.xml
  - CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .

