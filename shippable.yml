language: go

go:
  - 1.8

env:
  global:
    - CI_REPORT=shippable/testresults/junit.xml

before_install:
  - export GOPATH=$SHIPPABLE_GOPATH
  - go get github.com/t-yuki/gocover-cobertura    
  - go get golang.org/x/tools/cmd/cover
  - go get github.com/stretchr/objx
  - go get github.com/stretchr/testify/assert


# Make folders for the reports
before_script:
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage

script:
  - go test -coverprofile=coverage.txt -covermode count ./...
  - $GOPATH/bin/gocover-cobertura < coverage.txt > shippable/codecoverage/coverage.xml
  - CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .

after_script:
  - ls -al
  - cp main ./shippable/buildoutput
  - ls ./shippable -ltrR
  - cat ./shippable/codecoverage/coverage.xml
